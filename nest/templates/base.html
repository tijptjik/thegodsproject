<!DOCTYPE html>
<html lang="{{ DEFAULT_LANG }}">
    <head>
    {% block head %}
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="{% block description %}{% endblock description %}">
        <meta name="keywords" content="{% block keywords %}{% endblock keywords %}">

        <link rel="apple-touch-icon" sizes="57x57" href="{{ SITEURL }}/apple-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="{{ SITEURL }}/apple-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="{{ SITEURL }}/apple-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="{{ SITEURL }}/apple-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="{{ SITEURL }}/apple-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="{{ SITEURL }}/apple-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="{{ SITEURL }}/apple-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="{{ SITEURL }}/apple-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="{{ SITEURL }}/apple-icon-180x180.png">
        <link rel="icon" type="image/png" href="{{ SITEURL }}/favicon.ico">
        <link rel="icon" type="image/png" sizes="192x192"  href="{{ SITEURL }}/android-icon-192x192.png">
        <link rel="icon" type="image/png" sizes="32x32" href="{{ SITEURL }}/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="96x96" href="{{ SITEURL }}/favicon-96x96.png">
        <link rel="icon" type="image/png" sizes="16x16" href="{{ SITEURL }}/favicon-16x16.png">
        <link rel="manifest" href="{{ SITEURL }}/manifest.json">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="msapplication-TileImage" content="{{ SITEURL }}/ms-icon-144x144.png">
        <meta name="theme-color" content="#ffffff">

        <title>{% block title %}{{ SITENAME }}{% endblock title %}</title>

        <!-- Stylesheets -->
        {% if NEST_CSS_MINIFY %}
        <link href="{{ SITEURL }}/theme/css/all.min.css" rel="stylesheet">
        {% else %}
        <link href="{{ SITEURL }}/theme/css/bootstrap.min.css" rel="stylesheet">
        <link href="{{ SITEURL }}/theme/css/fonts.css" rel="stylesheet">
        <link href="{{ SITEURL }}/theme/css/nest.css" rel="stylesheet">
        <link href="{{ SITEURL }}/theme/css/pygment.css" rel="stylesheet">
        {% endif %}
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        {% if FEED_ALL_ATOM %}
        <link href="{{ FEED_DOMAIN }}/{{ FEED_ALL_ATOM }}" type="application/atom+xml" rel="alternate" title="{{ SITENAME }} Full Atom Feed" />
        {% endif %}
        {% if FEED_ALL_RSS %}
        <link href="{{ FEED_DOMAIN }}/{{ FEED_ALL_RSS }}" type="application/rss+xml" rel="alternate" title="{{ SITENAME }} Full RSS Feed" />
        {% endif %}
        {% if FEED_ATOM %}
        <link href="{{ FEED_DOMAIN }}/{{ FEED_ATOM }}" type="application/atom+xml" rel="alternate" title="{{ SITENAME }} Atom Feed" />
        {% endif %}
        {% if FEED_RSS %}
        <link href="{{ FEED_DOMAIN }}/{{ FEED_RSS }}" type="application/rss+xml" rel="alternate" title="{{ SITENAME }} RSS Feed" />
        {% endif %}
        {% if CATEGORY_FEED_ATOM and category %}
        <link href="{{ FEED_DOMAIN }}/{{ CATEGORY_FEED_ATOM|format(category.slug) }}" type="application/atom+xml" rel="alternate" title="{{ SITENAME }} Categories Atom Feed" />
        {% endif %}
        {% if CATEGORY_FEED_RSS and category %}
        <link href="{{ FEED_DOMAIN }}/{{ CATEGORY_FEED_RSS|format(category.slug) }}" type="application/rss+xml" rel="alternate" title="{{ SITENAME }} Categories RSS Feed" />
        {% endif %}
        {% if TAG_FEED_ATOM and tag %}
        <link href="{{ FEED_DOMAIN }}/{{ TAG_FEED_ATOM|format(tag.slug) }}" type="application/atom+xml" rel="alternate" title="{{ SITENAME }} Tags Atom Feed" />
        {% endif %}
        {% if TAG_FEED_RSS and tag %}
        <link href="{{ FEED_DOMAIN }}/{{ TAG_FEED_RSS|format(tag.slug) }}" type="application/rss+xml" rel="alternate" title="{{ SITENAME }} Tags RSS Feed" />
        {% endif %}
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

        {% if GOOGLE_ANALYTICS %}
        <!-- Google Analytics -->
        <script>
            (function(i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r;
                i[r] = i[r] || function() {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
                a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
                a.async = 1;
                a.src = g;
                m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

            ga('create', '{{ GOOGLE_ANALYTICS }}', 'auto');
            ga('send', 'pageview');

            function playEventHandler(song) {
                returnfunction(eventData) {
                    song.getCurrentSound(function(sound) {
                        setTimeout(function() {
                            window.soundB = sound.title;
                        }, 1);
                    });
                }
            }

            function playProgressEventHandler(song) {
                returnfunction(eventData) {
                    song.getCurrentSound(function(sound) {
                        window.t = Math.floor(eventData.relativePosition * 100);
                    });
                }
            }

            function pauseEventHandler(song) {
                returnfunction(eventData) {
                    song.getCurrentSound(function(sound) {
                        _gaq.push(['_trackEvent', 'SC_pause', window.soundB, calcT(window.t)]);
                    });
                }
            }

            function seekEventHandler(song) {
                returnfunction(eventData) {
                    song.getCurrentSound(function(sound) {
                        if (eventData.relativePosition === 0) {
                            _gaq.push(['_trackEvent', 'SC_complete', window.soundB, '100']);
                        }
                    });
                }
            }

            function calcT(_t) {
                if (_t <= 0 || _t > 100) return;
                var bucket = (_t > 10 ? 1 : 0) * (Math.floor((_t —  1) / 10) * 10 + 1);
                bucket = String(bucket) + '-' + String(Math.ceil(_t / 10) * 10);
                return bucket;
            }

            $(document).ready(function() {
                window.t = 0;
                window.soundB;
                var i, song, iframes = document.getElementsByTagName('iframe');
                for (i = 0; i < iframes.length; i++) {
                    if (iframes[i].src.indexOf('//w.soundcloud.com/player') > -1) {
                        iframes[i].id = "sc_player_" + i;
                        song = SC.Widget(iframes[i].id);
                        song.bind(SC.Widget.Events.PLAY_PROGRESS, playProgressEventHandler(song));
                        song.bind(SC.Widget.Events.PLAY, playEventHandler(song));
                        song.bind(SC.Widget.Events.PAUSE, pauseEventHandler(song));
                        song.bind(SC.Widget.Events.SEEK, seekEventHandler(song));
                    }
                }
            });
            $(window).on('beforeunload', function() {
                if (window.t !== 0) {
                    _gaq.push(['_trackEvent', 'SC_exit', window.soundB, calcT(window.t)]);
                }
            });



        </script>
        <!-- /Google Analytics -->
        {% endif %}

        {% if PIWIK_URL and PIWIK_SITE_ID %}
        <!-- Piwik Analytics -->
        <script type="text/javascript">
          var _paq = _paq || [];
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
            {% if PIWIK_SSL_URL %}
            var u="{{ PIWIK_SSL_URL }}/";
            {% else %}
            var u="{{ PIWIK_URL }}/";
            {% endif %}
            _paq.push(['setTrackerUrl', u+'piwik.php']);
            _paq.push(['setSiteId', {{ PIWIK_SITE_ID }}]);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
          })();
        </script>
        {% if PIWIK_SSL_URL %}
          <noscript><p><img src="{{ PIWIK_SSL_URL }}//piwik.php?idsite={{ PIWIK_SITE_ID }}" style="border:0;" alt="" /></p></noscript>
        {% else %}
          <noscript><p><img src="{{ PIWIK_URL }}/piwik.php?idsite={{ PIWIK_SITE_ID }}" style="border:0;" alt="" /></p></noscript>
        {% endif %}
        <!-- /Piwik Analytics -->
        {% endif %}

    {% endblock head %}
    </head>

    <body>

        <!-- Header -->
        {% block headerstyle %}
        {% endblock headerstyle %}

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="{{ SITEURL }}/">{{ SITENAME_SHORT }}</a>
                    </div>
                    <div class="nav pull-right">
                        {% for title, link in MENUITEMS %}
                            {% if 'http://' in link or 'https://' in link %}
                                <a href="{{ link }}">{{ title }}</a>
                            {% else %}
                                <a href="{{ SITEURL }}{{ link }}">{{ title }}</a>
                            {% endif %}
                        {% endfor %}
                        {% if DISPLAY_PAGES_ON_MENU %}
                        {% for pg in PAGES %}
                            <a {% if pg == page %} class="active"{% endif %} href="{{ SITEURL }}/{{ pg.url }}">{{ pg.title }}</a>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
            {% block header %}
            {% endblock header %}
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
        {% block content %}
        {% endblock %}
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">{{ NEST_SITEMAP_COLUMN_TITLE }}</div>
                        <ul class="list-unstyled">
                            {% for title, link in NEST_SITEMAP_MENU %}
                            <li><a href="{{ SITEURL }}{{ link }}">{{ title }}</a></li>
                            {% endfor %}
                            {% if FEED_ALL_ATOM %}
                            <li><a href="{{ FEED_DOMAIN }}/{{ FEED_ALL_ATOM }}" type="application/atom+xml" rel="alternate">{{ NEST_SITEMAP_ATOM_LINK }}</a></li>
                            {% endif %}
                            {% if FEED_ALL_RSS %}
                            <li><a href="{{ FEED_DOMAIN }}/{{ FEED_ALL_RSS }}" type="application/rss+xml" rel="alternate">{{ NEST_SITEMAP_RSS_LINK }}</a></li>
                            {% endif %}
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        {% if SOCIAL %}
                        <div class="footer-title">{{ NEST_SOCIAL_COLUMN_TITLE }}</div>
                        <ul class="list-unstyled">
                            {% for name, link in SOCIAL %}
                            <li><a href="{{ link }}" target="_blank">{{name}}</a></li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        {% if LINKS %}
                        <div class="footer-title">{{ NEST_LINKS_COLUMN_TITLE }}</div>
                        <ul class="list-unstyled">
                            {% for name, link in LINKS %}
                            <li><a href="{{ link }}" target="_blank">{{name}}</a></li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small>{{ NEST_COPYRIGHT }}</small>
                            {% if NEST_FOOTER_HTML %}<small><em>{{ NEST_FOOTER_HTML }}</em></small>{% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>
